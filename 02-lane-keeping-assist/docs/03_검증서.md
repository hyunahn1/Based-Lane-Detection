# Module 02: Lane Keeping Assist System - ê²€ì¦ì„œ

**ë²„ì „:** 1.0  
**ì‘ì„±ì¼:** 2026-01-30  
**ìƒíƒœ:** ê²€ì¦ ê³„íš

---

## ğŸ“‹ ëª©ì°¨

1. [ê²€ì¦ ê°œìš”](#1-ê²€ì¦-ê°œìš”)
2. [ì„±ëŠ¥ ëª©í‘œ (KPI)](#2-ì„±ëŠ¥-ëª©í‘œ-kpi)
3. [ê²€ì¦ í™˜ê²½](#3-ê²€ì¦-í™˜ê²½)
4. [ë‹¨ìœ„ í…ŒìŠ¤íŠ¸](#4-ë‹¨ìœ„-í…ŒìŠ¤íŠ¸)
5. [í†µí•© í…ŒìŠ¤íŠ¸](#5-í†µí•©-í…ŒìŠ¤íŠ¸)
6. [ì„±ëŠ¥ í…ŒìŠ¤íŠ¸](#6-ì„±ëŠ¥-í…ŒìŠ¤íŠ¸)
7. [ì•ˆì „ í…ŒìŠ¤íŠ¸](#7-ì•ˆì „-í…ŒìŠ¤íŠ¸)
8. [ì‹œë®¬ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸](#8-ì‹œë®¬ë ˆì´ì…˜-í…ŒìŠ¤íŠ¸)
9. [ì‹¤ì°¨ í…ŒìŠ¤íŠ¸](#9-ì‹¤ì°¨-í…ŒìŠ¤íŠ¸)
10. [ê²€ì¦ ê²°ê³¼ ë³´ê³ ](#10-ê²€ì¦-ê²°ê³¼-ë³´ê³ )

---

## 1. ê²€ì¦ ê°œìš”

### 1.1 ëª©ì 

Module 02 (Lane Keeping Assist)ê°€ ì•„í‚¤í…ì²˜ ì„¤ê³„ì„œì™€ êµ¬í˜„ ëª…ì„¸ì„œì— ëª…ì‹œëœ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ëŠ”ì§€ ê²€ì¦í•©ë‹ˆë‹¤.

### 1.2 ê²€ì¦ ë²”ìœ„

**In Scope:**
- âœ… ê¸°ëŠ¥ ê²€ì¦: ëª¨ë“  ì»´í¬ë„ŒíŠ¸ê°€ ëª…ì„¸ëŒ€ë¡œ ë™ì‘
- âœ… ì„±ëŠ¥ ê²€ì¦: KPI ëª©í‘œ ë‹¬ì„± ì—¬ë¶€
- âœ… ì•ˆì „ ê²€ì¦: Fail-safe ë©”ì»¤ë‹ˆì¦˜ ë™ì‘
- âœ… í†µí•© ê²€ì¦: Module 01ê³¼ì˜ ì—°ë™

**Out of Scope:**
- âŒ í•˜ë“œì›¨ì–´ ìˆ˜ì¤€ ê²€ì¦ (CAN í†µì‹  ë“±)
- âŒ ë²•ê·œ ì í•©ì„± ê²€ì¦ (ISO 11270)
- âŒ ëŒ€ê·œëª¨ ì‹¤ë„ë¡œ í…ŒìŠ¤íŠ¸

### 1.3 ê²€ì¦ ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 4: Real-World Test                   â”‚
â”‚  - PiRacer ì‹¤ì°¨ í…ŒìŠ¤íŠ¸                        â”‚
â”‚  - ì‹¤ì œ íŠ¸ë™ ì£¼í–‰                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 3: Simulation Test                   â”‚
â”‚  - CARLA / Gazebo ì‹œë®¬ë ˆì´ì…˜                  â”‚
â”‚  - ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 2: Integration Test                  â”‚
â”‚  - Module 01 + Module 02 E2E                â”‚
â”‚  - ë…¹í™”ëœ ë¹„ë””ì˜¤ë¡œ í…ŒìŠ¤íŠ¸                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Level 1: Unit Test                         â”‚
â”‚  - ê°œë³„ ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸                    â”‚
â”‚  - Mock ë°ì´í„° ì‚¬ìš©                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ì„±ëŠ¥ ëª©í‘œ (KPI)

### 2.1 ì •ëŸ‰ì  KPI (RC íŠ¸ë™ í™˜ê²½ ê¸°ì¤€)

| ë©”íŠ¸ë¦­ | ëª©í‘œ | ì¸¡ì • ë°©ë²• | ìš°ì„ ìˆœìœ„ | í•©ê²© ê¸°ì¤€ |
|--------|------|-----------|---------|----------|
| **ì²˜ë¦¬ ì§€ì—°ì‹œê°„** | < 30ms | Frame-to-command | P0 (í•„ìˆ˜) | Pass/Fail |
| **ì°¨ì„  ì¤‘ì‹¬ ì¶”ì • MAE** | < 5cm | Ground truth ëŒ€ë¹„ | P0 (í•„ìˆ˜) | Pass/Fail |
| **ì´íƒˆ ê°ì§€ Precision** | > 85% | TP/(TP+FP) | P0 (í•„ìˆ˜) | Pass/Fail |
| **ì´íƒˆ ê°ì§€ Recall** | > 90% | TP/(TP+FN) | P0 (í•„ìˆ˜) | Pass/Fail |
| **False Warning Rate** | < 5 per 100 laps | RC íŠ¸ë™ ì£¼í–‰ | P1 (ê¶Œì¥) | ì„±ëŠ¥ í‰ê°€ |
| **ì¡°í–¥ ì•ˆì •ì„± (Jerk)** | < 50Â°/sÂ² | ì¡°í–¥ê° 2ì°¨ ë¯¸ë¶„ | P1 (ê¶Œì¥) | ì„±ëŠ¥ í‰ê°€ |
| **íŠ¸ë™ ì™„ì£¼ìœ¨** | > 80% | 10íšŒ ì£¼í–‰ ì„±ê³µ | P0 (í•„ìˆ˜) | Pass/Fail |
| **í‰ê·  ì£¼í–‰ ì†ë„** | > 1.0 m/s | ì‹¤ì¸¡ | P1 (ê¶Œì¥) | ì„±ëŠ¥ í‰ê°€ |
| **CPU ì‚¬ìš©ë¥ ** | < 40% | ë‹¨ì¼ ì½”ì–´ (RPi4) | P2 (ì„ íƒ) | ì°¸ê³  |
| **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰** | < 100MB | RSS | P2 (ì„ íƒ) | ì°¸ê³  |

**KPI ì„¤ì • ê·¼ê±°:**
- **30ms**: Python + NumPy ì²˜ë¦¬ ì‹œê°„ ê³ ë ¤
- **5cm**: RC íŠ¸ë™(35cm í­)ì˜ 14%, ì¹´ë©”ë¼ í•´ìƒë„ í•œê³„
- **85%/90%**: ì´ˆê¸° êµ¬í˜„ í˜„ì‹¤ì  ëª©í‘œ, íŠœë‹ í›„ ê°œì„ 
- **5/100 laps**: 1 lap = 20m, 100 laps = 2km ì£¼í–‰

### 2.2 ì •ì„±ì  ëª©í‘œ

| í•­ëª© | ê¸°ì¤€ | í‰ê°€ ë°©ë²• |
|------|------|-----------|
| **ë¶€ë“œëŸ¬ìš´ ì œì–´** | ì‚¬ìš©ì ë¶ˆí¸ ì—†ìŒ | ì£¼ê´€ì  í‰ê°€ (5ì  ì²™ë„) |
| **ì˜ˆì¸¡ ê°€ëŠ¥ì„±** | ì‹œìŠ¤í…œ ë™ì‘ ì˜ˆì¸¡ ê°€ëŠ¥ | ì‚¬ìš©ì ì„¤ë¬¸ |
| **íˆ¬ëª…ì„±** | ê²°ì • ê³¼ì • ì¶”ì  ê°€ëŠ¥ | ë¡œê·¸ ë¶„ì„ |
| **ê°•ê±´ì„±** | ë‹¤ì–‘í•œ ì¡°ê±´ì—ì„œ ì•ˆì • | ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ |

---

## 3. ê²€ì¦ í™˜ê²½

### 3.1 í•˜ë“œì›¨ì–´

**ê°œë°œ í™˜ê²½:**
- CPU: Intel i7 ë˜ëŠ” ë™ê¸‰
- RAM: 16GB+
- GPU: ë¶ˆí•„ìš” (Module 01ì—ì„œë§Œ ì‚¬ìš©)
- OS: Ubuntu 22.04 / macOS / Windows 10+

**ì‹¤ì°¨ í™˜ê²½ (PiRacer):**
- SBC: Raspberry Pi 4B (4GB RAM)
- Camera: Pi Camera V2 (1080p)
- Motor: DC Motor + Servo
- Power: 2S LiPo Battery

### 3.2 ì†Œí”„íŠ¸ì›¨ì–´

```yaml
Python: 3.10+
Packages:
  - pytest: 7.4+
  - pytest-cov: 4.1+
  - pytest-benchmark: 4.0+
  - numpy: 1.24+
  - scipy: 1.10+
  - opencv-python: 4.8+
```

### 3.3 í…ŒìŠ¤íŠ¸ ë°ì´í„°

**í•©ì„± ë°ì´í„°:**
- ì§ì„  ì°¨ì„ : 100 samples
- ê³¡ì„  ì°¨ì„ : 100 samples
- ì´íƒˆ ì‹œë‚˜ë¦¬ì˜¤: 50 samples

**ì‹¤ì œ ë°ì´í„°:**
- Module 01 ì¶œë ¥ (ë…¹í™”): 500 frames
- PiRacer ì£¼í–‰ ì˜ìƒ: 10ë¶„

---

## 4. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

### 4.1 `LaneTracker` í…ŒìŠ¤íŠ¸

**íŒŒì¼:** `tests/test_lane_tracker.py`

#### Test Case 1: ì •ìƒ ì¶”ì 
```python
def test_lane_tracker_normal():
    """ì •ìƒì ì¸ ì°¨ì„  ì¶”ì  í…ŒìŠ¤íŠ¸ (ì§ì„  íŠ¸ë™)"""
    tracker = LaneTracker()
    
    # ì§ì„  ì°¨ì„  polyline (ì´ë¯¸ì§€ ì¤‘ì•™ ìˆ˜ì§ì„ )
    polyline = [(320, i) for i in range(100, 480, 10)]
    confidence = 0.95
    
    result = tracker.track(polyline, confidence)
    
    # ê²€ì¦
    assert result["is_valid"] == True
    
    # ì°¨ëŸ‰ì´ ì¤‘ì•™(320, 432)ì´ê³  ì°¨ì„ ë„ ì¤‘ì•™(320)ì´ë©´ offset â‰ˆ 0
    assert abs(result["lateral_offset"]) < 0.02  # 2cm ì´ë‚´ (ê±°ì˜ 0)
    
    # ì§ì„ ì´ë¯€ë¡œ heading ë³€í™” ê±°ì˜ ì—†ìŒ
    assert abs(result["heading_error"]) < 5.0  # 5ë„ ì´ë‚´ (ê·¼ì‚¬ ì˜¤ì°¨ í—ˆìš©)
    
    # ì§ì„ ì´ë¯€ë¡œ ê³¡ë¥  ê±°ì˜ 0
    assert abs(result["curvature"]) < 0.5  # RC íŠ¸ë™ ìŠ¤ì¼€ì¼ ê³ ë ¤
```

#### Test Case 2: ë‚®ì€ ì‹ ë¢°ë„
```python
def test_lane_tracker_low_confidence():
    """ë‚®ì€ ì‹ ë¢°ë„ ì…ë ¥ ì²˜ë¦¬"""
    tracker = LaneTracker(min_confidence=0.5)
    
    polyline = [(320, i) for i in range(100, 480, 10)]
    confidence = 0.3  # ë‚®ì€ ì‹ ë¢°ë„
    
    result = tracker.track(polyline, confidence)
    
    # ê²€ì¦
    assert result["is_valid"] == False
    assert "reason" in result
```

#### Test Case 3: ê³¡ì„  ì°¨ì„ 
```python
def test_lane_tracker_curve():
    """ê³¡ì„  ì°¨ì„  ì¶”ì  (ê³¡ë¥  ê³„ì‚°)"""
    tracker = LaneTracker()
    
    # ì›í˜• ê³¡ì„  ìƒì„± (í”½ì…€ ì¢Œí‘œ)
    center = (320, 240)
    radius_px = 200  # pixels
    polyline = [
        (center[0] + radius_px * np.cos(theta),
         center[1] + radius_px * np.sin(theta))
        for theta in np.linspace(-np.pi/2, np.pi/2, 30)
    ]
    
    result = tracker.track(polyline, 0.9)
    
    # ê²€ì¦
    assert result["is_valid"] == True
    assert result["curvature"] != 0.0  # ê³¡ë¥  ì¡´ì¬ (0ì´ ì•„ë‹˜)
    
    # ê³¡ë¥  ë¶€í˜¸ ê²€ì¦ (ìœ„ polylineì€ ì™¼ìª½ ì»¤ë¸Œ)
    assert result["curvature"] > 0
    
    # ê³¡ë¥  í¬ê¸° í•©ë¦¬ì„± ê²€ì¦
    # 200px ë°˜ì§€ë¦„ â‰ˆ 0.3m (RC íŠ¸ë™), ê³¡ë¥  â‰ˆ 1/0.3 = 3.33 m^-1
    # í”½ì…€-ë¯¸í„° ë³€í™˜ ì˜¤ì°¨ ê³ ë ¤í•˜ì—¬ ë„‰ë„‰í•œ ë²”ìœ„
    assert 1.0 < result["curvature"] < 10.0  # í•©ë¦¬ì  ë²”ìœ„
    
    # Note: ì •í™•í•œ ê°’ ë¹„êµëŠ” ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜ í•„ìš”
```

#### Test Case 4: ë¶ˆì¶©ë¶„í•œ ì 
```python
def test_lane_tracker_insufficient_points():
    """í¬ì¸íŠ¸ ë¶€ì¡± ì²˜ë¦¬"""
    tracker = LaneTracker()
    
    polyline = [(320, 240), (320, 250)]  # 2ê°œë§Œ
    
    result = tracker.track(polyline, 0.9)
    
    # ê²€ì¦
    assert result["is_valid"] == False
```

**ì»¤ë²„ë¦¬ì§€ ëª©í‘œ:** > 90%

### 4.2 `DepartureDetector` í…ŒìŠ¤íŠ¸

**íŒŒì¼:** `tests/test_departure_detector.py`

#### Test Case 5: ì•ˆì „ ì£¼í–‰
```python
def test_departure_detector_safe():
    """ì•ˆì „ ì£¼í–‰ ìƒíƒœ (RC íŠ¸ë™)"""
    detector = DepartureDetector(track_width=0.35)
    
    result = detector.detect(
        lateral_offset=0.03,   # 3cm (ì•ˆì „ ë²”ìœ„)
        heading_error=3.0,     # 3ë„ (ì‘ì€ ë³€í™”)
        vehicle_speed=1.2,     # 1.2 m/s (RC ì†ë„)
        timestamp=0.0
    )
    
    # ê²€ì¦
    assert result["is_departing"] == False
    assert result["risk_level"] == 0
    assert result["departure_side"] == "right"
    assert result["time_to_crossing"] > 5.0  # ì¶©ë¶„í•œ ì‹œê°„ ì—¬ìœ 
```

#### Test Case 6: ê²½ê³  ë ˆë²¨
```python
def test_departure_detector_warning():
    """ê²½ê³  ë ˆë²¨ ì´íƒˆ (RC íŠ¸ë™)"""
    detector = DepartureDetector(track_width=0.35)
    
    result = detector.detect(
        lateral_offset=0.13,  # 13cm (Warning level)
        heading_error=22.0,   # 22ë„ (Warning level)
        vehicle_speed=1.5,    # 1.5 m/s
        timestamp=0.0
    )
    
    # ê²€ì¦
    assert result["is_departing"] == True
    assert result["risk_level"] == 3  # Warning
    assert result["time_to_crossing"] < 3.0  # ë¹ ë¥´ê²Œ ëŒ€ì‘ í•„ìš”
```

#### Test Case 7: ê¸´ê¸‰ ìƒí™©
```python
def test_departure_detector_emergency():
    """ê¸´ê¸‰ ì´íƒˆ ìƒí™© (RC íŠ¸ë™)"""
    detector = DepartureDetector(track_width=0.35)
    
    result = detector.detect(
        lateral_offset=0.19,  # 19cm (íŠ¸ë™ ê²½ê³„ ì´ˆê³¼!)
        heading_error=45.0,   # 45ë„ (ë§¤ìš° í° ê°ë„)
        vehicle_speed=1.8,    # 1.8 m/s (ê³ ì†)
        timestamp=0.0
    )
    
    # ê²€ì¦
    assert result["is_departing"] == True
    assert result["risk_level"] == 5  # Emergency
    assert result["time_to_crossing"] < 0.5  # ë§¤ìš° ê¸´ê¸‰
```

**ì»¤ë²„ë¦¬ì§€ ëª©í‘œ:** > 95%

### 4.3 `PIDController` í…ŒìŠ¤íŠ¸

**íŒŒì¼:** `tests/test_pid_controller.py`

#### Test Case 8: P ì œì–´
```python
def test_pid_controller_proportional():
    """ë¹„ë¡€ ì œì–´ í…ŒìŠ¤íŠ¸"""
    controller = PIDController(
        params=PIDParams(kp=1.0, ki=0.0, kd=0.0, k_heading=0.0)
    )
    
    steering = controller.compute(
        lateral_offset=0.5,
        heading_estimate=0.0,
        curvature=0.0
    )
    
    # P ì œì–´ë§Œ: steering = kp * error = 1.0 * 0.5 = 0.5
    expected = 1.0 * 0.5  # kp * offset
    assert abs(steering - expected) < 0.01
```

#### Test Case 9: ì ë¶„ ëˆ„ì 
```python
def test_pid_controller_integral():
    """ì ë¶„ ì œì–´ í…ŒìŠ¤íŠ¸"""
    params = PIDParams(kp=0.0, ki=1.0, kd=0.0)
    controller = PIDController(params, dt=0.1)
    
    # 10ìŠ¤í… ë™ì•ˆ error=0.1 ìœ ì§€
    for _ in range(10):
        steering = controller.compute(0.1, 0.0, 0.0)
    
    # I term = ki * âˆ«error dt = 1.0 * (0.1 * 0.1 * 10) = 0.1
    expected = 1.0 * (0.1 * 0.1 * 10)
    assert abs(steering - expected) < 0.01
```

#### Test Case 10: Anti-windup
```python
def test_pid_controller_antiwindup():
    """Anti-windup í…ŒìŠ¤íŠ¸"""
    params = PIDParams(kp=0.0, ki=1.0, kd=0.0, windup_limit=1.0)
    controller = PIDController(params, dt=0.1)
    
    # í° ì—ëŸ¬ë¡œ ì ë¶„ í¬í™”ì‹œí‚¤ê¸°
    for _ in range(100):
        controller.compute(10.0, 0.0, 0.0)
    
    # ì ë¶„ê°’ì´ windup_limitìœ¼ë¡œ ì œí•œë˜ì–´ì•¼ í•¨
    assert abs(controller._integral) <= params.windup_limit
```

#### Test Case 11: ì¡°í–¥ê° ì œí•œ
```python
def test_pid_controller_steering_limit():
    """ì¡°í–¥ê° ì œí•œ í…ŒìŠ¤íŠ¸"""
    controller = PIDController()
    
    # ë§¤ìš° í° ì—ëŸ¬
    steering = controller.compute(100.0, 100.0, 0.0)
    
    # ìµœëŒ€ ì¡°í–¥ê° ì´ë‚´
    assert abs(steering) <= controller.params.max_steering_angle
```

**ì»¤ë²„ë¦¬ì§€ ëª©í‘œ:** > 95%

### 4.4 `WarningSystem` í…ŒìŠ¤íŠ¸

**íŒŒì¼:** `tests/test_warning_system.py`

#### Test Case 12: ë ˆë²¨ë³„ ê²½ê³ 
```python
@pytest.mark.parametrize("risk_level,expected_visual,expected_audio", [
    (0, False, False),  # Safe
    (1, False, False),  # Normal
    (2, True, False),   # Caution (ì‹œê°ë§Œ)
    (3, True, True),    # Warning (ì‹œê°+ì²­ê°)
    (4, True, True),    # Critical (ì‹œê°+ì²­ê°+í–…í‹±)
    (5, True, True),    # Emergency (ëª¨ë‘)
])
def test_warning_system_levels(risk_level, expected_visual, expected_audio):
    """ìœ„í—˜ë„ë³„ ê²½ê³  í™œì„±í™”"""
    warning_system = WarningSystem()
    
    warning_system.update(risk_level, "right")
    
    assert warning_system.is_visual_active() == expected_visual
    assert warning_system.is_audio_active() == expected_audio
```

**ì»¤ë²„ë¦¬ì§€ ëª©í‘œ:** > 90%

---

## 5. í†µí•© í…ŒìŠ¤íŠ¸

### 5.1 E2E íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸

**íŒŒì¼:** `tests/test_integration.py`

#### Test Case 13: ì „ì²´ íŒŒì´í”„ë¼ì¸
```python
def test_e2e_pipeline():
    """Module 01 â†’ Module 02 ì „ì²´ í”Œë¡œìš° (ì •ìƒ ì£¼í–‰)"""
    # Module 01 Mock ì¶œë ¥ (ì§ì„  íŠ¸ë™ ì¤‘ì•™)
    lane_detection_output = {
        "lane_polyline": [(320, i) for i in range(100, 480, 10)],
        "confidence": 0.95
    }
    
    # Module 02 ì´ˆê¸°í™”
    lkas = LaneKeepingAssist(config_path="config/lkas_params.yaml")
    
    # ì²˜ë¦¬ (RC ì†ë„)
    result = lkas.process_frame(
        lane_detection=lane_detection_output,
        vehicle_state={"speed": 1.2}  # 1.2 m/s (RC car speed)
    )
    
    # ê²€ì¦
    assert "steering_angle" in result
    assert "warning_level" in result
    assert "lateral_offset" in result
    
    # ì¤‘ì•™ ì£¼í–‰ì´ë¯€ë¡œ ê²½ê³  ì—†ìŒ
    assert result["warning_level"] <= 1
    assert result["is_intervening"] == False
    
    # Lateral offset ì‘ì•„ì•¼ í•¨
    assert abs(result["lateral_offset"]) < 0.05  # 5cm ì´ë‚´
```

#### Test Case 14: ì´íƒˆ ì‹œë‚˜ë¦¬ì˜¤
```python
def test_e2e_departure_scenario():
    """ì´íƒˆ ì‹œë‚˜ë¦¬ì˜¤ í†µí•© í…ŒìŠ¤íŠ¸ (RC íŠ¸ë™)"""
    # ì°¨ì„ ì´ ì™¼ìª½ìœ¼ë¡œ ì´ë™ (ì°¨ëŸ‰ì€ ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´íƒˆ)
    # ì´ë¯¸ì§€ ì¤‘ì•™ = 320, ì°¨ì„ ì´ 280ìœ¼ë¡œ ì´ë™ = 40px ì°¨ì´
    lane_detection_output = {
        "lane_polyline": [(280, i) for i in range(100, 480, 10)],  # ì™¼ìª½
        "confidence": 0.9
    }
    
    lkas = LaneKeepingAssist(config_path="config/lkas_params.yaml")
    result = lkas.process_frame(
        lane_detection_output,
        {"speed": 1.2}  # 1.2 m/s
    )
    
    # ê²€ì¦
    # 40px â‰ˆ 3-4cm (ì›ê·¼ ë³´ì • ì ìš©), lateral_offset > 0 (ìš°ì¸¡ ì´íƒˆ)
    assert result["lateral_offset"] > 0.02  # 2cm ì´ìƒ
    
    # ì´íƒˆ ê°ì§€
    if result["lateral_offset"] > 0.08:  # 8cm ì´ìƒì´ë©´
        assert result["warning_level"] >= 2  # ê²½ê³  ë°œìƒ
        assert result["is_intervening"] == True  # ê°œì… ì‹œì‘
        assert result["steering_angle"] < 0  # ì™¼ìª½ìœ¼ë¡œ ì¡°í–¥ (ì°¨ì„  ìª½ìœ¼ë¡œ)
    
    # Lateral offset í•©ë¦¬ì  ë²”ìœ„
    assert abs(result["lateral_offset"]) < 0.20  # ìµœëŒ€ 20cm
```

---

## 6. ì„±ëŠ¥ í…ŒìŠ¤íŠ¸

### 6.1 ì²˜ë¦¬ ì‹œê°„ ë²¤ì¹˜ë§ˆí¬

```python
def test_benchmark_latency(benchmark):
    """ì²˜ë¦¬ ì§€ì—°ì‹œê°„ ë²¤ì¹˜ë§ˆí¬ (Module 02 ë‹¨ë…)"""
    lkas = LaneKeepingAssist(config_path="config/lkas_params.yaml")
    
    # ì „í˜•ì ì¸ RC íŠ¸ë™ ì…ë ¥
    lane_detection = {
        "lane_polyline": [(320, i) for i in range(100, 480, 10)],
        "confidence": 0.95
    }
    vehicle_state = {"speed": 1.2}  # m/s
    
    # ë²¤ì¹˜ë§ˆí¬ ì‹¤í–‰ (100íšŒ ë°˜ë³µ)
    result = benchmark(lkas.process_frame, lane_detection, vehicle_state)
    
    # ê²€ì¦: < 30ms (Python êµ¬í˜„)
    assert benchmark.stats['mean'] < 0.030  # 30ms
    
    # ì¶”ê°€ ë©”íŠ¸ë¦­
    print(f"Mean: {benchmark.stats['mean']*1000:.2f}ms")
    print(f"Std:  {benchmark.stats['stddev']*1000:.2f}ms")
    print(f"Min:  {benchmark.stats['min']*1000:.2f}ms")
    print(f"Max:  {benchmark.stats['max']*1000:.2f}ms")
```

**Note:** Module 01 ì²˜ë¦¬ ì‹œê°„(~10ms)ì€ ë³„ë„ë¡œ ì¸¡ì •

### 6.2 ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰

```python
import psutil
import os

def test_memory_usage():
    """ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¸¡ì •"""
    process = psutil.Process(os.getpid())
    mem_before = process.memory_info().rss / 1024 / 1024  # MB
    
    # LKAS ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° 100 í”„ë ˆì„ ì²˜ë¦¬
    lkas = LaneKeepingAssist()
    for _ in range(100):
        lane_detection = {
            "lane_polyline": [(320, i) for i in range(100, 480, 10)],
            "confidence": 0.95
        }
        lkas.process_frame(lane_detection, {"speed": 60.0})
    
    mem_after = process.memory_info().rss / 1024 / 1024  # MB
    mem_used = mem_after - mem_before
    
    # ê²€ì¦: < 100MB
    assert mem_used < 100
```

---

## 7. ì•ˆì „ í…ŒìŠ¤íŠ¸

### 7.1 Fail-Safe í…ŒìŠ¤íŠ¸

```python
def test_failsafe_low_confidence():
    """ë‚®ì€ ì‹ ë¢°ë„ ì…ë ¥ ì‹œ ì•ˆì „ ëª¨ë“œ (Fail-safe)"""
    lkas = LaneKeepingAssist(config_path="config/lkas_params.yaml")
    
    lane_detection = {
        "lane_polyline": [(320, i) for i in range(100, 480, 10)],
        "confidence": 0.4  # ë‚®ì€ ì‹ ë¢°ë„ (< 0.6 threshold)
    }
    
    result = lkas.process_frame(lane_detection, {"speed": 1.2})
    
    # Fail-safe ë™ì‘ ê²€ì¦
    assert result["is_intervening"] == False  # ê°œì… ì¤‘ë‹¨
    assert result["steering_angle"] == 0.0  # ì¡°í–¥ ëª…ë ¹ ì—†ìŒ
    assert result["warning_level"] <= 1  # ê²½ê³ ë§Œ (ë‚®ì€ ë ˆë²¨)
    
    # ë¡œê·¸ì— fail-safe ê¸°ë¡ í™•ì¸
    # (ì‹¤ì œ êµ¬í˜„ ì‹œ logger ì¶œë ¥ ê²€ì¦)
```

### 7.2 Watchdog í…ŒìŠ¤íŠ¸

```python
import threading
import time

def test_watchdog_timeout():
    """Watchdog timeout í…ŒìŠ¤íŠ¸"""
    lkas = LaneKeepingAssist()
    
    # ì²˜ë¦¬ ì‹œê°„ì´ ê¸´ í•¨ìˆ˜ë¡œ ë¸”ë¡œí‚¹
    def slow_process():
        time.sleep(1.0)  # 1ì´ˆ ì§€ì—°
    
    # Watchdog í™œì„±í™” (timeout=0.1ì´ˆ)
    with pytest.raises(TimeoutError):
        lkas._execute_with_watchdog(slow_process, timeout=0.1)
```

---

## 8. ì‹œë®¬ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸

### 8.1 ì‹œë®¬ë ˆì´ì…˜ ì „ëµ

**í™˜ê²½ ì„ íƒ:**
- **Option A**: ë…¹í™”ëœ ë¹„ë””ì˜¤ ì¬ìƒ (Module 01 ì¶œë ¥ ì‚¬ìš©)
- **Option B**: CARLA/Gazebo (ì„ íƒì‚¬í•­, RC íŠ¸ë™ ëª¨ë¸ í•„ìš”)
- **ì¶”ì²œ**: Option A (ë¹ ë¥´ê³  ì¬í˜„ ê°€ëŠ¥)

### 8.2 ë¹„ë””ì˜¤ ê¸°ë°˜ ì‹œë®¬ë ˆì´ì…˜

**ì‹œë‚˜ë¦¬ì˜¤ 1: RC íŠ¸ë™ ì§ì„  ì£¼í–‰**
```yaml
Scenario:
  Name: "RC Track Straight Section"
  Track: ì‹¤ë‚´ íŠ¸ë™ ì§ì„  êµ¬ê°„
  Vehicle Speed: 1.0-1.5 m/s
  Duration: 30 seconds (ì•½ 30-45m)
  
Expected:
  - íŠ¸ë™ ìœ ì§€ìœ¨: > 90%
  - False Warning: < 3íšŒ
  - í‰ê·  íš¡ë°©í–¥ ì˜¤í”„ì…‹: < 5cm
  - ì¡°í–¥ ê°ë„: Â±10ë„ ì´ë‚´
```

**ì‹œë‚˜ë¦¬ì˜¤ 2: RC íŠ¸ë™ ì»¤ë¸Œ êµ¬ê°„**
```yaml
Scenario:
  Name: "RC Track Curved Section"
  Track: ë°˜ê²½ 1-2m ì»¤ë¸Œ
  Vehicle Speed: 0.8-1.2 m/s
  Duration: 20 seconds
  
Expected:
  - íŠ¸ë™ ìœ ì§€ìœ¨: > 80%
  - ìµœëŒ€ íš¡ë°©í–¥ ì˜¤í”„ì…‹: < 8cm
  - ì¡°í–¥ Jerk: < 50Â°/sÂ²
  - Feedforward ì‘ë™ í™•ì¸
```

**ì‹œë‚˜ë¦¬ì˜¤ 3: ì €ì‹ ë¢°ë„ ì°¨ì„  ê°ì§€**
```yaml
Scenario:
  Name: "Low Confidence Lane Detection"
  Track: ì°¨ì„  í‘œì‹œ í¬ë¯¸ ë˜ëŠ” ì¡°ëª… ë³€í™” (confidence < 0.6)
  Vehicle Speed: 1.0 m/s
  Duration: 15 seconds
  
Expected:
  - Fail-safe í™œì„±í™”
  - ì¡°í–¥ ê°œì… ì¤‘ë‹¨ (steering_angle = 0)
  - ê²½ê³  ë°œìƒ (warning_level = 1-2)
  - ì‹œìŠ¤í…œ ë³µêµ¬ (confidence íšŒë³µ ì‹œ)
```

---

## 9. ì‹¤ì°¨ í…ŒìŠ¤íŠ¸

### 9.1 PiRacer í…ŒìŠ¤íŠ¸ ì ˆì°¨

**ì¤€ë¹„ ë‹¨ê³„:**
1. PiRacer í•˜ë“œì›¨ì–´ ê²€ì‚¬
2. ë°°í„°ë¦¬ ì¶©ì „ í™•ì¸
3. ì¹´ë©”ë¼ ìº˜ë¦¬ë¸Œë ˆì´ì…˜
4. í†µì‹  í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ íŠ¸ë™:**
- ì‹¤ë‚´ RC íŠ¸ë™
- íŠ¸ë™ í­: 30-40cm
- íŠ¸ë™ ê¸¸ì´: 10-20m
- ì§ì„  + ì»¤ë¸Œ í˜¼í•© êµ¬ê°„

**ì¸¡ì • í•­ëª©:**
- **ì£¼í–‰ ì„±ê³µë¥ **: ì™„ì£¼ ë¹„ìœ¨ (10íšŒ ì‹œë„)
- **ì°¨ì„  ì´íƒˆ íšŸìˆ˜**: íŠ¸ë™ ê²½ê³„ ì¹¨ë²” íšŸìˆ˜
- **í‰ê·  ì†ë„**: ì£¼í–‰ ì¤‘ í‰ê·  ì†ë„ (m/s)
- **ë°˜ì‘ ì‹œê°„**: ì´íƒˆ ê°ì§€ â†’ ì¡°í–¥ ê°œì… ì‹œê°„
- **Lateral Offset ë¶„í¬**: í‰ê· , í‘œì¤€í¸ì°¨, ìµœëŒ€ê°’
- **ì¡°í–¥ ê°ë„ ë¶„í¬**: í‰ê· , í‘œì¤€í¸ì°¨, Jerk

**Ground Truth ìˆ˜ì§‘ ë°©ë²•:**
1. íŠ¸ë™ ì¤‘ì•™ì— ê¸°ì¤€ì„  í‘œì‹œ (í…Œì´í”„)
2. ìƒë‹¨ ì¹´ë©”ë¼ë¡œ ì°¨ëŸ‰ ìœ„ì¹˜ ì¶”ì 
3. ì˜ìƒ ë¶„ì„ìœ¼ë¡œ ì‹¤ì œ lateral offset ì¸¡ì •
4. LKAS ì¶”ì •ê°’ê³¼ ë¹„êµ

**ì•ˆì „ ì¡°ì¹˜:**
- ë¹„ìƒ ì •ì§€ ë²„íŠ¼ ì¤€ë¹„ (RC ë¦¬ëª¨ì»¨)
- ìµœëŒ€ ì†ë„ ì œí•œ (50% throttle = 1.5 m/s)
- ì¶©ëŒ ë°©ì§€ íŒ¨ë”© ì„¤ì¹˜
- ê´€ì°°ì 2ëª… ë°°ì¹˜ (ì œì–´/ê¸°ë¡)

---

## 10. ê²€ì¦ ê²°ê³¼ ë³´ê³ 

### 10.1 ë³´ê³ ì„œ êµ¬ì¡°

```markdown
# Module 02 ê²€ì¦ ë³´ê³ ì„œ

## ìš”ì•½
- í…ŒìŠ¤íŠ¸ ì¼ì: YYYY-MM-DD
- í…ŒìŠ¤íŠ¸ í™˜ê²½: [í™˜ê²½ ì •ë³´]
- ì „ì²´ Pass Rate: XX%

## ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- ì´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤: XXê°œ
- Pass: XXê°œ
- Fail: XXê°œ
- ì»¤ë²„ë¦¬ì§€: XX%

## ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
- í‰ê·  ì²˜ë¦¬ ì‹œê°„: XX ms
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: XX MB
- CPU ì‚¬ìš©ë¥ : XX%

## ì•ˆì „ í…ŒìŠ¤íŠ¸
- Fail-safe ë™ì‘: Pass/Fail
- Watchdog ë™ì‘: Pass/Fail

## ì‹œë®¬ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸
- ì‹œë‚˜ë¦¬ì˜¤ 1: Pass/Fail
- ì‹œë‚˜ë¦¬ì˜¤ 2: Pass/Fail
...

## ì‹¤ì°¨ í…ŒìŠ¤íŠ¸
- ì£¼í–‰ ì„±ê³µë¥ : XX%
- ì´íƒˆ íšŸìˆ˜: XXíšŒ
...

## ê²°ë¡ 
- KPI ë‹¬ì„±ë¥ : XX%
- ê°œì„  í•„ìš” ì‚¬í•­: [ë¦¬ìŠ¤íŠ¸]
- ìµœì¢… íŒì •: Pass/Fail
```

---

**ë‹¤ìŒ ë‹¨ê³„:** ì‹¤ì œ êµ¬í˜„ í›„ ì´ ê²€ì¦ ê³„íšì— ë”°ë¼ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰

**ì‘ì„±ì:** [ì´ë¦„]  
**ë¦¬ë·°ì–´:** [ì´ë¦„]  
**ìŠ¹ì¸ì:** [ì´ë¦„]
