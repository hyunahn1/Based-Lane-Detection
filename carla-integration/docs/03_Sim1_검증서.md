# Simulation 1: Traditional LKAS - 검증서

**날짜:** 2026-01-30  
**버전:** 1.0  
**목표:** CARLA 통합 시스템 검증 계획

---

## 1. 검증 목표

### 1.1 핵심 검증 항목
1. ✅ CARLA 환경 정상 작동
2. ✅ Module 01, 02, 03 통합 성공
3. ✅ 실시간 제어 가능 (30Hz)
4. ✅ Lane keeping 정확도
5. ✅ Obstacle avoidance 작동

---

## 2. 테스트 계획

### 2.1 Unit Tests (주말 - No CARLA)

```python
# test_interfaces.py
def test_lane_detector_interface():
    """Lane detector interface 검증"""
    detector = LaneDetectorNode(model_path='dummy.pth', device='cpu')
    # Interface 검증만
    pass

def test_lane_keeper_interface():
    """Lane keeper interface 검증"""
    keeper = LaneKeeperNode()
    control = keeper.compute_control(0.1, 0.05, 1.5, 0.033)
    assert 'steering' in control
    assert 'throttle' in control
    print("✅ PASS")

def test_object_detector_interface():
    """Object detector interface 검증"""
    # Interface만 검증
    pass
```

### 2.2 Integration Tests (월요일 - With CARLA)

```python
# test_carla_integration.py
def test_carla_connection():
    """CARLA 연결 테스트"""
    carla = CarlaInterface()
    carla.connect()
    assert carla.client is not None
    print("✅ PASS: CARLA connection")

def test_vehicle_spawn():
    """Vehicle 생성 테스트"""
    carla = CarlaInterface()
    carla.connect()
    vehicle = carla.spawn_vehicle()
    assert vehicle is not None
    print("✅ PASS: Vehicle spawn")

def test_camera_stream():
    """Camera 스트림 테스트"""
    carla = CarlaInterface()
    carla.connect()
    carla.spawn_vehicle()
    carla.spawn_camera()
    
    time.sleep(2)
    image = carla.get_latest_image()
    assert image is not None
    assert image.shape == (480, 640, 3)
    print("✅ PASS: Camera stream")

def test_end_to_end():
    """전체 파이프라인 테스트"""
    # Setup
    carla = CarlaInterface()
    carla.connect()
    carla.spawn_vehicle()
    carla.spawn_camera()
    
    lane_detector = LaneDetectorNode(...)
    lane_keeper = LaneKeeperNode()
    object_detector = ObjectDetectorNode()
    
    # Run 100 frames
    for i in range(100):
        image = carla.get_latest_image()
        if image is None:
            continue
        
        lane_info = lane_detector.detect(image)
        object_info = object_detector.detect(image)
        
        vehicle_state = carla.get_vehicle_state()
        control = lane_keeper.compute_control(
            lane_info['lateral_offset'],
            lane_info['heading_error'],
            vehicle_state['velocity'],
            0.033
        )
        
        if object_info['collision_risk']:
            control['throttle'] = 0.0
        
        carla.apply_control(control['steering'], control['throttle'])
        
        time.sleep(0.033)
    
    print("✅ PASS: End-to-end pipeline")
```

---

## 3. 성능 목표

### 3.1 Latency

| Component | Target | Acceptable |
|-----------|--------|------------|
| Module 01 | < 20ms | < 30ms |
| Module 03 | < 30ms | < 50ms |
| Module 02 | < 5ms | < 10ms |
| Total | < 65ms | < 100ms |

**Target FPS:** 15-30 Hz

### 3.2 Control Accuracy

| Metric | Target |
|--------|--------|
| Lane center MAE | < 10cm |
| Success rate (lap completion) | > 90% |
| Collision avoidance | 100% |

---

## 4. 월요일 체크리스트

### 4.1 환경 준비 (30분)
- [ ] CARLA 설치 확인
- [ ] GPU driver 확인
- [ ] Python 환경 설정
- [ ] 모델 파일 준비

### 4.2 실행 (1시간)
- [ ] CARLA 서버 시작
- [ ] Python 스크립트 실행
- [ ] 첫 이미지 수신 확인
- [ ] 모듈 로드 확인

### 4.3 디버깅 (2-3시간)
- [ ] Import 에러 수정
- [ ] Path 문제 해결
- [ ] CARLA API 호환성
- [ ] 제어 튜닝

### 4.4 Demo (1시간)
- [ ] 안정적 주행 확인
- [ ] Screen recording
- [ ] 결과 저장

---

## 5. 예상 이슈 & 해결

### 5.1 CARLA 관련

**Issue:** Connection timeout
```python
Solution:
  - CARLA 서버 먼저 실행
  - 포트 확인 (2000)
  - Firewall 확인
```

**Issue:** Vehicle spawn 실패
```python
Solution:
  - Spawn point 충돌 확인
  - 다른 위치 시도
  - World reload
```

### 5.2 Module 통합

**Issue:** Path import 에러
```python
Solution:
  - sys.path에 모듈 경로 추가
  - __init__.py 확인
```

**Issue:** Model load 실패
```python
Solution:
  - Model path 확인
  - Device 설정 (cuda/cpu)
  - Checkpoint 호환성
```

---

## 6. 성공 기준

### Minimum (합격)
- [ ] CARLA 실행 ✅
- [ ] 차량 생성 ✅
- [ ] Camera 작동 ✅
- [ ] Module 01 작동 ✅
- [ ] 기본 제어 ✅

### Target (목표)
- [ ] 30Hz 실시간 ✅
- [ ] Lane keeping 작동 ✅
- [ ] Object detection 작동 ✅
- [ ] 1 lap 완주 ✅

### Excellent (우수)
- [ ] < 10cm lane accuracy ✅
- [ ] 0 collision ✅
- [ ] Smooth control ✅
- [ ] Video demo ✅

---

**작성자:** AI Development Team  
**날짜:** 2026-01-30  
**Status:** Verification Plan Complete  
**Next:** Code Implementation
