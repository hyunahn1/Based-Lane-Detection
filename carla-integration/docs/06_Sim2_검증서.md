# Simulation 2: End-to-End with ViT - 검증서

**날짜:** 2026-01-30  
**버전:** 1.0  
**목표:** E2E Learning 시스템 검증 계획

---

## 1. 검증 목표

### 1.1 핵심 검증 항목
1. ✅ CARLA 환경 정상 작동
2. ✅ Module 06 (E2E) 통합 성공
3. ✅ Image → Control 직접 작동
4. ✅ Attention visualization
5. ✅ Real-time 가능 (20Hz+)

---

## 2. 테스트 계획

### 2.1 Unit Tests (주말 - No CARLA)

```python
# test_sim2.py

def test_e2e_model_interface():
    """E2E model interface 검증"""
    # Interface 구조만 검증
    pass

def test_attention_visualizer():
    """Attention visualizer 검증"""
    viz = AttentionVisualizer()
    image = np.random.randint(0, 255, (224, 224, 3), dtype=np.uint8)
    attention = np.random.rand(14, 14)
    result = viz.visualize(image, attention)
    assert result.shape == (224, 224, 3)
    print("✅ PASS")

def test_integration_logic():
    """통합 로직 검증"""
    # Image → E2E → Control 플로우
    pass
```

### 2.2 Integration Tests (월요일 - With CARLA)

```python
# test_carla_e2e.py

def test_carla_connection():
    """CARLA 연결 테스트"""
    carla = CarlaInterface()
    carla.connect()
    print("✅ PASS")

def test_e2e_inference():
    """E2E 추론 테스트"""
    e2e_model = E2EModelNode(...)
    image = carla.get_latest_image()
    prediction = e2e_model.predict(image)
    
    assert 'steering' in prediction
    assert 'throttle' in prediction
    assert -1 <= prediction['steering'] <= 1
    assert 0 <= prediction['throttle'] <= 1
    print("✅ PASS")

def test_end_to_end():
    """전체 파이프라인 테스트"""
    # 100 frames 주행
    for i in range(100):
        image = carla.get_image()
        prediction = e2e_model.predict(image)
        carla.apply_control(
            steering=prediction['steering'] * 45.0,
            throttle=prediction['throttle']
        )
    print("✅ PASS")
```

---

## 3. 성능 목표

### 3.1 Latency

| Component | Target | Acceptable |
|-----------|--------|------------|
| ViT Inference | < 30ms | < 50ms |
| Attention Viz | < 10ms | < 20ms |
| **Total** | **< 40ms** | **< 70ms** |

**Target FPS:** 20-30 Hz

### 3.2 Control Quality

| Metric | Target |
|--------|--------|
| Steering smoothness | High |
| Lane keeping | Moderate |
| Success rate | > 70% |

**Note:** 학습된 모델 아니므로 성능은 제한적

---

## 4. 월요일 체크리스트

### 4.1 환경 준비 (10분)
- [ ] CARLA 서버 실행
- [ ] Sim 1 CARLA interface 재사용
- [ ] Module 06 체크포인트 확인

### 4.2 실행 (30분)
- [ ] Python 스크립트 실행
- [ ] E2E model 로드 확인
- [ ] Control output 확인

### 4.3 Demo (30분)
- [ ] Attention visualization
- [ ] Screen recording
- [ ] 결과 저장

---

## 5. 예상 이슈 & 해결

### 5.1 Model 관련

**Issue:** Model 학습 안 됨
```python
Solution:
  - Random control 출력 (정상)
  - Demo용으로는 충분
  - "Pre-training 후 Fine-tuning 필요" 명시
```

**Issue:** Attention 추출 안 됨
```python
Solution:
  - Dummy attention map 사용
  - 구조 시연만으로도 OK
```

---

## 6. 성공 기준

### Minimum (합격)
- [ ] CARLA 실행 ✅
- [ ] E2E model 로드 ✅
- [ ] Control output ✅
- [ ] 기본 주행 (10초) ✅

### Target (목표)
- [ ] 20Hz 실시간 ✅
- [ ] Attention 시각화 ✅
- [ ] 1분 주행 ✅

### Excellent (우수)
- [ ] 30Hz ✅
- [ ] Smooth control ✅
- [ ] Clear attention ✅
- [ ] Demo video ✅

---

## 7. Sim 1 vs Sim 2 비교 테스트

### 동일 트랙 주행 비교

| Metric | Sim 1 (Traditional) | Sim 2 (E2E) |
|--------|---------------------|-------------|
| Architecture | Multi-stage | Single-stage |
| Latency | ~30ms | ~40ms |
| Explainability | High | Low |
| Flexibility | High | Low |
| 최신 기술 | Medium | High |

**결론:** 
- Sim 1: 안정적, 명확
- Sim 2: 최신, 연구 지향

---

**작성자:** AI Development Team  
**날짜:** 2026-01-30  
**Status:** Verification Plan Complete  
**Next:** Code Implementation
